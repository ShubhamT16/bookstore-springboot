<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bookstore Management</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* CSS styles for table and form */
        /* Add your custom styles here */
    </style>
</head>
<body>
<h1>Bookstore Management</h1>

<!-- Display table of books -->
<table id="booksTable">
    <thead>
    <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Author</th>
        <th>ISBN</th>
        <th>Price</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <!-- Book details will be populated here dynamically -->
    </tbody>
</table>

<hr>

<!-- Form to add/update book -->
<form id="bookForm">
    <label for="title">Title:</label>
    <input type="text" id="title" name="title" required><br><br>

    <label for="author">Author:</label>
    <input type="text" id="author" name="author" required><br><br>

    <label for="isbn">ISBN:</label>
    <input type="text" id="isbn" name="isbn" required><br><br>

    <label for="price">Price:</label>
    <input type="text" id="price" name="price" required><br><br>

    <button type="submit" id="submitBtn">Add Book</button>
    <button type="button" id="cancelBtn" style="display: none;">Cancel</button>
</form>

<script>
    // Function to fetch and display books
    function fetchBooks() {
        fetch('/books')
            .then(response => response.json())
            .then(data => {
                const booksTable = document.getElementById('booksTable').getElementsByTagName('tbody')[0];
                booksTable.innerHTML = '';
                data.forEach(book => {
                    const row = booksTable.insertRow();
                    row.innerHTML = `
                        <td>${book.id}</td>
                        <td>${book.title}</td>
                        <td>${book.author}</td>
                        <td>${book.isbn}</td>
                        <td>${book.price}</td>
                        <td>
                            <button onclick="editBook(${book.id})">Edit</button>
                            <button onclick="deleteBook(${book.id})">Delete</button>
                        </td>
                    `;
                });
            })
            .catch(error => console.error('Error fetching books:', error));
    }

    // Function to add or update a book
    function addOrUpdateBook(event) {
        event.preventDefault();
        const formData = new FormData(document.getElementById('bookForm'));
        const book = {};
        formData.forEach((value, key) => book[key] = value);
        const method = document.getElementById('submitBtn').innerText === 'Add Book' ? 'POST' : 'PUT';
        const url = method === 'POST' ? '/books' : `/books/${document.getElementById('bookId').value}`;
        fetch(url, {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(book)
        })
            .then(response => {
                if (response.ok) {
                    fetchBooks(); // Refresh book list
                    document.getElementById('bookForm').reset();
                    document.getElementById('submitBtn').innerText = 'Add Book';
                    document.getElementById('cancelBtn').style.display = 'none';
                } else {
                    console.error('Error adding/updating book:', response.statusText);
                }
            })
            .catch(error => console.error('Error adding/updating book:', error));
    }

    // Function to edit a book
    function editBook(id) {
        fetch(`/books/${id}`)
            .then(response => response.json())
            .then(book => {
                document.getElementById('title').value = book.title;
                document.getElementById('author').value = book.author;
                document.getElementById('isbn').value = book.isbn;
                document.getElementById('price').value = book.price;
                document.getElementById('bookId').value = book.id;
                document.getElementById('submitBtn').innerText = 'Update Book';
                document.getElementById('cancelBtn').style.display = 'inline';
            })
            .catch(error => console.error('Error fetching book:', error));
    }

    // Function to delete a book
    function deleteBook(id) {
        if (confirm('Are you sure you want to delete this book?')) {
            fetch(`/books/${id}`, {
                method: 'DELETE'
            })
                .then(response => {
                    if (response.ok) {
                        fetchBooks(); // Refresh book list
                    } else {
                        console.error('Error deleting book:', response.statusText);
                    }
                })
                .catch(error => console.error('Error deleting book:', error));
        }
    }

    // Event listener for form submission
    document.getElementById('bookForm').addEventListener('submit', addOrUpdateBook);

    // Event listener for cancel button
    document.getElementById('cancelBtn').addEventListener('click', function() {
        document.getElementById('bookForm').reset();
        document.getElementById('submitBtn').innerText = 'Add Book';
        document.getElementById('cancelBtn').style.display = 'none';
    });

    // Fetch and display books when page loads
    window.addEventListener('load', fetchBooks);
</script>
</body>
</html>
